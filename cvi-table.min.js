function getTable(){return document.getElementById("cviTable")}function getTableBody(){return getTable().getElementsByTagName("tbody")[0]}function exportInfo(){var e,r,t,a,n,o,i=getTableBody(),l=[];for(e=0,r=i.rows.length;e<r;e++){for(n=[],n.push(i.rows[e].cells[1].innerHTML),t=2,a=i.rows[e].cells.length;t<a;t++)n.push(parseInt(i.rows[e].cells[t].innerHTML));l.push(n)}o=new Blob([JSON.stringify(l)],{type:"application/json;charset=utf-8"}),saveAs(o,"cvi-data.json")}function triggerDownload(e,r){var t=new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}),a=document.createElement("a");a.setAttribute("download",r),a.setAttribute("href",e),a.setAttribute("target","_blank"),a.dispatchEvent(t)}function saveSVG(){var e=new Blob([cviRender.svg.svg()],{type:"image/svg+xml;charset=utf-8"});saveAs(e,"cvi-image.svg")}function savePNG(){_exportImage("PNG")}function saveJPG(){_exportImage("JPG")}function _exportImage(e){if(!cviRender)return void alert("No image has been rendered.");var r=document.getElementById("canvas");r.width=cviRender.svg.width(),r.height=cviRender.svg.height();var t=r.getContext("2d"),a=cviRender.svg.svg(),n=window.URL||window.webkitURL||window,o=new Image,i=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),l=n.createObjectURL(i),d="image/png",s="cvi-image";if("JPG"==e)d="image/jpeg",s+=".jpg";else{if("PNG"!=e)return void alert("Unknown image format: "+e);d="image/png",s+=".png"}o.onload=function(){t.drawImage(o,0,0),n.revokeObjectURL(l);var e=r.toDataURL(d).replace(d,"image/octet-stream");triggerDownload(e,s)},o.src=l}function importJSONFile(e){var r=new FileReader;r.readAsText(e,"UTF-8"),r.onerror=function(){alert("Unable to read "+file.fileName)},r.onload=function(e){var r,t,a=e.target.result;try{r=JSON.parse(a);for(t in r)__addTableRow(r[t])}catch(e){return void alert("Failed to parse JSON file: "+e)}}}function importCSVFile(e){var r=new FileReader;r.readAsText(e,"UTF-8"),r.onerror=function(){alert("Unable to read "+file.fileName)},r.onload=function(e){var r,t,a,n,o,i,l,d=e.target.result;try{o=d.split("\n");for(t in o)if(n=o[t],r=[],!(n.match(/innovator/gi)&&n.match(/banker/gi)&&n.match(/merchant/gi)&&n.match(/builder/gi))){l=n.split(",");for(a in l)i=l[a].replace(/"/g,""),0==a?r.push(i):r.push(parseInt(i));__addTableRow(r)}}catch(e){return void alert("Failed to parse CSV file: "+e)}}}function fileUpload(){var e,r,t=document.getElementById("uploadFile2"),a=t.files;for(r=0;r<a.length;r++)e=a[r],e.name.endsWith(".json")?importJSONFile(e):e.name.endsWith(".xls")||e.name.endsWith(".xls")?alert("Importing data from MS-Excel is not supported.  Sorry."):importCSVFile(e);t.value=null}function deleteControl(){var e=$(this).closest("tr"),r=cviDataTable.row(e),t=r.data(),a=new CVIProfile(t[1],t[2],t[3],t[4],t[5]);switch(groupCviProfile.removeProfile(a),r.remove().draw(!1),groupCviProfile.profiles.length){case 0:cviRender.render(groupCviProfile);break;case 1:cviRender.render(groupCviProfile.profiles[0]);break;default:cviRender.render(groupCviProfile)}}function deleteRows(e,r,t,a){var n=cviDataTable.rows({selected:!0});switch(n.data().each(function(e){var r=new CVIProfile(e[1],e[2],e[3],e[4],e[5]);groupCviProfile.removeProfile(r)}),n.remove().draw(!1),groupCviProfile.profiles.length){case 0:cviRender.render(groupCviProfile);break;case 1:cviRender.render(groupCviProfile.profiles[0]);break;default:cviRender.render(groupCviProfile)}}function addTableRow(){console.log("addTableRow()");var e,r,t,a=[],n=[],o=["newName","newBuilder","newMerchant","newInnovator","newBanker"];for(e in o)r=document.getElementById(o[e]),r&&r.value?a.push(r.value):n.push(o[e].slice(3,20));if(a.length<o.length)return t="",n.length>1&&(t="s"),void alert("Cannot add row. '{0}' parameter{1} not provided.".format(n,t));console.log("Params: ",a.toString()),a[1]=parseInt(a[1]),a[2]=parseInt(a[2]),a[3]=parseInt(a[3]),a[4]=parseInt(a[4]),__addTableRow(a);for(e in o)r=document.getElementById(o[e]),r.value=""}function __addTableRow(e){var r=[""],t=cviDataTable.row.add(r.concat(e)).draw().node();$(t).addClass("td-cvi-param");var a=$(t).children();a[0].classList.add("delete-control"),a[0].innerHTML='<button type="button" class="btn btn-default btn-sm"><i class="fa fa-times"></i></button>';for(var n=1;n<a.length;n++)a[n].classList.add("cvi-draw-control")}function rowClick(){var e=cviDataTable,r=e.row(this),t=r.data();if(t&&6==t.length){var a=$(this).hasClass("selected");$(this).toggleClass("selected");var n=new CVIProfile(t[1],t[2],t[3],t[4],t[5]);switch(a?groupCviProfile.removeProfile(n):groupCviProfile.addProfile(n),groupCviProfile.profiles.length){case 0:cviRender.render(groupCviProfile);break;case 1:cviRender.render(groupCviProfile.profiles[0]);break;default:cviRender.render(groupCviProfile)}}}
