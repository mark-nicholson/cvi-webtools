"use strict";function cvi(name){var cviProfile,cviMark=new CVIProfile("Mark Nicholson",14,21,29,8),cviKaren=new CVIProfile("Karen Nicholson",16,29,14,13),cviGroup=new CVIGroupProfile("Nicholsons",[cviMark,cviKaren]);cviProfile="karen"==name?cviKaren:"mark"==name?cviMark:cviGroup;var cviRender=new CVIRender("cviCanvas");cviRender.render(cviProfile)}function cviTool(name,folks){if(folks&&0!=folks.length){cviRender=new CVIRender("svgDivID");var profiles=[];for(var f in folks){console.log(folks[f]);var p=new CVIProfile(folks[f][0],folks[f][1],folks[f][2],folks[f][3],folks[f][4]);profiles.push(p)}if(1==profiles.length)return void cviRender.render(profiles[0]);var group=new CVIGroupProfile(name,profiles);cviRender.render(group)}}function cvi_test(){var t=new Tester;console.log("con_var: "+t.cons_var),console.log("staticProp: "+Tester.myStaticProperty)}String.prototype.format||(String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return"undefined"!=typeof args[number]?args[number]:match})});class Point{constructor(x,y){this._x=x,this._y=y,this.ox=0,this.oy=0,this.scale=1}copy(){var npt=new Point(this._x,this._y);return npt.ox=this.ox,npt.oy=this.oy,npt.scale=this.scale,npt}x(){return this._x*this.scale+this.ox}y(){return this._y*this.scale+this.oy}toString(){return"[{0},{1}] s={2}, o:[{3},{4}] -> [{5},{6}]".format(this._x,this._y,this.scale,this.ox,this.oy,this.x(),this.y())}dump(){console.log(this.toString())}}class Line{constructor(p1,p2){return p1.ox!=p2.ox||p1.oy!=p2.oy?null:(this.p1=p1,this.p2=p2,void(this.p2.x()-this.p1.x()==0?(this.x_intercept=new Point(this.p1.x(),0),this.y_intercept=new Point(0,NaN)):(this.m=(this.p2.y()-this.p1.y())/(this.p2.x()-this.p1.x()),this.b=this.p2.y()-this.m*this.p2.x(),this.x_intercept=new Point(-this.b/this.m,0),this.y_intercept=new Point(0,0*this.m+this.b))))}toString(){return"y = {0}x + {1}  xi:[{2},{3}]  yi:[{4},{5}]".format(this.m,this.b,this.x_intercept.x(),this.x_intercept.y(),this.y_intercept.x(),this.y_intercept.y())}dump(){console.log(this.toString())}xIntercept(){return this.x_intercept.copy()}yIntercept(){return this.y_intercept.copy()}}class CVIProfile{constructor(name,builder,merchant,innovator,banker){this.name=name,this.builder=builder,this.merchant=merchant,this.innovator=innovator,this.banker=banker}intuitiveType(){return this.builder+this.merchant}independentType(){return this.builder+this.innovator}practicalType(){return this.builder+this.banker}creativeType(){return this.merchant+this.innovator}communityType(){return this.merchant+this.banker}cognitiveType(){return this.innovator+this.banker}toString(){return"CVI[{0}: {1}, {2}, {3}, {4} ]".format(this.name,this.builder,this.merchant,this.innovator,this.banker)}builderPoint(){return new Point(-this.builder,-this.builder)}merchantPoint(){return new Point(this.merchant,-this.merchant)}innovatorPoint(){return new Point(this.innovator,this.innovator)}bankerPoint(){return new Point(-this.banker,this.banker)}builderBankerLine(){return new Line(this.builderPoint(),this.bankerPoint())}merchantBuilderLine(){return new Line(this.merchantPoint(),this.builderPoint())}innovatorMerchantLine(){return new Line(this.innovatorPoint(),this.merchantPoint())}bankerInnovatorLine(){return new Line(this.bankerPoint(),this.innovatorPoint())}builderPoints(){return[this.merchantBuilderLine().yIntercept(),this.builderPoint(),this.builderBankerLine().xIntercept()]}merchantPoints(){return[this.merchantBuilderLine().yIntercept(),this.merchantPoint(),this.innovatorMerchantLine().xIntercept()]}innovatorPoints(){return[this.innovatorMerchantLine().xIntercept(),this.innovatorPoint(),this.bankerInnovatorLine().yIntercept()]}bankerPoints(){return[this.bankerInnovatorLine().yIntercept(),this.bankerPoint(),this.builderBankerLine().xIntercept()]}}CVIProfile.maxScore=30;class CVIGroupProfile extends CVIProfile{constructor(name,profiles){super(name,0,0,0,0),this.profiles=profiles,this._update()}_update(){var i,pr,inn=0,mer=0,ban=0,bui=0;for(i in this.profiles)pr=this.profiles[i],bui+=pr.builder,mer+=pr.merchant,inn+=pr.innovator,ban+=pr.banker;this.profiles.length>0?(this.builder=bui/this.profiles.length,this.merchant=mer/this.profiles.length,this.innovator=inn/this.profiles.length,this.banker=ban/this.profiles.length):(this.builder=0,this.merchant=0,this.innovator=0,this.banker=0)}addProfile(p){var i;for(i in this.profiles)if(p.name==this.profiles[i].name)return console.log("addProfile(): found duplicate of '"+p.name+"'."),!1;return this.profiles.push(p),this._update(),!0}removeProfile(p){var i;for(i in this.profiles)if(p.name==this.profiles[i].name){console.log("removeProfile(): found '"+p.name+"'. Removing it."),this.profiles.splice(i,1);break}this._update()}}class CVIRender{constructor(svgDivID){this.svgDivID=svgDivID,this.erase(),this.svg=SVG(svgDivID).size(700,700),this.scale=this.svg.width()/2/CVIProfile.maxScore,this.origin=new Point(this.svg.width()/2,this.svg.height()/2)}erase(){console.log("erase()");for(var svgDiv=document.getElementById(this.svgDivID);svgDiv.childElementCount>0;)svgDiv.removeChild(svgDiv.firstChild)}merchantQuadrantInfo(){return{quadrant:[1,-1],points:[],title:"Merchant","core-value":"Love","fill-colour":[CVIRender.merchantLightColour,CVIRender.merchantDarkColour],"title-location":[.8,.3]}}innovatorQuadrantInfo(){return{quadrant:[1,1],points:[],title:"Innovator","core-value":"Wisdom","fill-colour":[CVIRender.innovatorLightColour,CVIRender.innovatorDarkColour],"title-location":[.8,1.1]}}bankerQuadrantInfo(){return{quadrant:[-1,1],points:[],title:"Banker","core-value":"Knowledge","fill-colour":[CVIRender.bankerLightColour,CVIRender.bankerDarkColour],"title-location":[.2,1.1]}}builderQuadrantInfo(){return{quadrant:[-1,-1],points:[],title:"Builder","core-value":"Power","fill-colour":[CVIRender.builderLightColour,CVIRender.builderDarkColour],"title-location":[.2,.3]}}_get_quadrants(cviProfile){var quads=[this.builderQuadrantInfo(),this.merchantQuadrantInfo(),this.innovatorQuadrantInfo(),this.bankerQuadrantInfo()];return cviProfile&&(quads[0].points=cviProfile.builderPoints(),quads[1].points=cviProfile.merchantPoints(),quads[2].points=cviProfile.innovatorPoints(),quads[3].points=cviProfile.bankerPoints()),quads}renderQuandrantBackgrounds(){var qi,qInfo,x,y,w,h,cssColour=CVIRender.quadrantBackgroundColour,quads=this._get_quadrants(null);for(qi in quads)qInfo=quads[qi].quadrant,w=CVIProfile.maxScore,h=CVIProfile.maxScore,x=0,qInfo[0]<0&&(x-=w),y=0,qInfo[1]<0&&(y-=h),this.bgGroup.rect(w,h).move(x,y).fill(cssColour)}renderTextLayer(cviProfile){var qi,qInfo,xLoc,yLoc,title,att,quads=this._get_quadrants(null),f1Size=2,f2Size=1.5;for(qi in quads)qInfo=quads[qi],att=qInfo.title.toLowerCase(),title=qInfo.title+" ",title+=Number.isInteger(cviProfile[att])?cviProfile[att]:cviProfile[att].toFixed(2),xLoc=CVIProfile.maxScore*qInfo["title-location"][0],yLoc=CVIProfile.maxScore*qInfo["title-location"][1],qInfo.quadrant[0]<0&&(xLoc-=CVIProfile.maxScore),qInfo.quadrant[1]<0&&(yLoc-=CVIProfile.maxScore),this.textGroup.text(title).move(xLoc,yLoc-f1Size/1.5).fill("black").font({family:"Arial",size:f1Size,anchor:"middle"}),this.textGroup.text("["+qInfo["core-value"]+"]").move(xLoc,yLoc+f1Size/1.5).fill("black").font({family:"Arial",size:f2Size,anchor:"middle"})}renderReferencePoints(pList){var pi,pt;for(pi in pList)pt=pList[pi],this.polyGroup.circle(4/this.scale).move(pt.x()-2/this.scale,pt.y()-2/this.scale).fill("black")}renderPolygon(qInfo,drawBorder){var gradient,pi,pt;gradient=this.svg.gradient("linear",function(stop){stop.at(0,qInfo["fill-colour"][0]),stop.at(1,qInfo["fill-colour"][1])}),qInfo.quadrant[0]>0&&qInfo.quadrant[1]>0?gradient.from(0,0).to(1,1):qInfo.quadrant[0]>0&&qInfo.quadrant[1]<0?gradient.from(0,1).to(1,0):qInfo.quadrant[0]<0&&qInfo.quadrant[1]>0?gradient.from(1,0).to(0,1):gradient.from(1,1).to(0,0);var pgPts=[[0,0]];for(pi in qInfo.points)pt=qInfo.points[pi],pgPts.push([pt.x(),pt.y()]);this.polyGroup.polygon(pgPts).fill(gradient),drawBorder&&(this.polyGroup.line(qInfo.points[0].x(),qInfo.points[0].y(),qInfo.points[1].x(),qInfo.points[1].y()).stroke({width:3/this.scale,color:CVIRender.borderColour}),this.polyGroup.line(qInfo.points[1].x(),qInfo.points[1].y(),qInfo.points[2].x(),qInfo.points[2].y()).stroke({width:3/this.scale,color:CVIRender.borderColour}))}render(data){var pi,qi,quads,qInfo,profile,profiles,cviProfile;if(this.allGroup=this.svg.group(),this.bgGroup=this.allGroup.group(),this.polyGroup=this.allGroup.group(),this.textGroup=this.allGroup.group(),this.coordGroup=this.allGroup.group(),data instanceof CVIGroupProfile){profiles=[];for(pi in data.profiles)profiles.push(data.profiles[pi]);profiles.push(data),cviProfile=data}else data instanceof CVIProfile?(profiles=[],cviProfile=data):(cviProfile=data.shift(),profiles=data);this.renderQuandrantBackgrounds();for(pi in profiles){profile=profiles[pi],quads=this._get_quadrants(profile);for(qi in quads)qInfo=quads[qi],this.renderPolygon(qInfo,!1),this.renderReferencePoints(qInfo.points)}var drawBorder=0!=profiles.length;quads=this._get_quadrants(cviProfile);for(qi in quads)qInfo=quads[qi],this.renderPolygon(qInfo,drawBorder),this.renderReferencePoints(qInfo.points);this.renderTextLayer(cviProfile),this.renderCoordinateLines(),this.allGroup.scale(this.scale).translate(this.origin.x(),this.origin.y())}renderCoordinateLines(){this.coordGroup.line(0,-CVIProfile.maxScore,0,CVIProfile.maxScore).stroke({width:6/this.scale,color:"white"}),this.coordGroup.line(CVIProfile.maxScore,0,-CVIProfile.maxScore,0).stroke({width:6/this.scale,color:"white"})}}CVIRender.quadrantBackgroundColour="#E6E6E6",CVIRender.merchantLightColour="#D5DDEC",CVIRender.merchantDarkColour="#345AA3",CVIRender.innovatorLightColour="#F6DCFB",CVIRender.innovatorDarkColour="#D55EEA",CVIRender.bankerLightColour="#C1DCBF",CVIRender.bankerDarkColour="#32842D",CVIRender.builderLightColour="#FBC9C8",CVIRender.builderDarkColour="#F03230",CVIRender.borderColour="#afafaf";class Tester{constructor(){this.cons_var=2}}Tester.myStaticProperty="yes";
